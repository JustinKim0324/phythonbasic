<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <base href="/phythonbasic/">
  <title>강의 보기</title>

  <!-- 기본 스타일 -->
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; line-height: 1.6; margin: 24px; color:#222; }
    .container { max-width: 860px; margin: 0 auto; }
    .topbar { display:flex; align-items:center; gap:12px; margin-bottom:16px; }
    .topbar a { text-decoration:none; color:#2563eb; }
    .status { font-size:14px; color:#666; }
    img { max-width:100%; height:auto; }
    blockquote { border-left:4px solid #e5e7eb; margin: 0; padding: 0 12px; color:#555; }

    /* 코드 블록 */
    pre { overflow:auto; border-radius:10px; padding: 14px; }
    code, pre code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 0.95rem; }
    :not(pre) > code { background:#f6f8fa; padding:2px 6px; border-radius:6px; }
  </style>

  <!-- Markdown 렌더러 -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- highlight.js (문법 하이라이트) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css">
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/common.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <a href="index.html">← 목록으로</a>
      <span class="status" id="status">강의 내용을 불러오는 중…</span>
    </div>
    <article id="content"></article>
  </div>

  <script>
    (function () {
      const params   = new URLSearchParams(location.search);
      const rawFile  = params.get('file') || 'lessons1.md';
      const isSafe   = /^[a-zA-Z0-9._-]+\.md$/.test(rawFile);
      const file     = isSafe ? rawFile : 'lessons1.md';

      const statusEl  = document.getElementById('status');
      const contentEl = document.getElementById('content');

      // marked 옵션에 highlight.js 연결
      marked.setOptions({
        highlight(code, lang) {
          try {
            if (lang && hljs.getLanguage(lang)) {
              return hljs.highlight(code, { language: lang }).value;
            }
            return hljs.highlightAuto(code).value;
          } catch (e) {
            return code;
          }
        },
        gfm: true,
        breaks: false
      });

      fetch(file, { cache: 'no-store' })
        .then(res => {
          if (!res.ok) throw new Error(`(${res.status}) ${res.statusText}`);
          return res.text();
        })
        .then(md => {
          contentEl.innerHTML = marked.parse(md);
          statusEl.textContent = file + ' 로딩 완료';

          // 코드 블록 다시 확인 (혹시 누락된 경우 대비)
          document.querySelectorAll('pre code').forEach(block => {
            hljs.highlightElement(block);
          });
        })
        .catch(err => {
          statusEl.textContent = '로딩 실패';
          contentEl.innerHTML = `
            <p>파일을 불러오지 못했습니다: <code>${file}</code></p>
            <pre>${String(err)}</pre>
          `;
        });
    })();
  </script>
</body>
</html>
